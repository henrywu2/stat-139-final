---
title: "Socioeconomic Determinants of 2020 U.S. Presidential Election County-Level Voter Turnout"
subtitle: "Exploratory Data Analysis"
author: "Yuen Ler Chow, John Rho, and Henry Wu"
output: pdf_document
urlcolor: blue
---


```{r setup, message=FALSE, warning=FALSE}
rm(list = ls())
require(readr)
require(tidyr)
require(dplyr)
require(knitr)
require(glmnet)
require(pheatmap)
if (!require("Matrix")) install.packages("Matrix", repos = "https://cloud.r-project.org")
if (!require("glmnet")) install.packages("glmnet", repos = "https://cloud.r-project.org")
library(Matrix)
library(glmnet)
library(pheatmap)

options(repos = c(CRAN = "https://cloud.r-project.org"))
```

# Data Description

The dataset combines voter turnout data from the [MIT Election Lab](https://doi.org/10.7910/DVN/VOQCHQ), U.S. Census Bureau’s [2020 ACS 5-year estimates](https://data.census.gov/table/ACSDT5Y2020.B05003), and socioeconomic and demographic predictors from [Opportunity Insights](https://opportunityinsights.org/). Voter turnout is computed as the total votes cast in the 2020 U.S. presidential election divided by the voting-eligible population (U.S. citizens aged 18 or above). For Alaska, voter turnout estimates are derived from [this blog post](https://rrhelections.com/index.php/2021/04/13/alaska-presidential-results-by-county-equivalent-1960-2020/9/).

Predictor variables include a wide variety of socioeconomic and demographic measures at the county level, such as education levels, poverty rates, median household income, and racial/ethnic population shares. More details and data dictionary information are available at the Opportunity Insights website. FIPS codes from the U.S. Census Bureau are used to merge data sources.

# Data Loading and Cleaning

```{r}
turnout_data <- read.csv("data.csv")
head(turnout_data)
```

# Descriptive Statistics

Below, we summarize continuous predictors, including missing values and various summary statistics.

```{r}
predictors <- names(turnout_data)[!(names(turnout_data) %in% c('State', 'County', 'fips'))]
summary_table <- data.frame()

for (predictor in predictors) {
  column <- turnout_data[[predictor]]
  num_missing <- sum(is.na(column))
  mean_var <- mean(column, na.rm = TRUE)
  median_var <- median(column, na.rm = TRUE)
  sd_var <- sd(column, na.rm = TRUE)
  iqr_var <- IQR(column, na.rm = TRUE)
  min_var <- min(column, na.rm = TRUE)
  max_var <- max(column, na.rm = TRUE)

  summary_table <- rbind(summary_table, data.frame(
    Variable = predictor,
    Missing = num_missing,
    Mean = round(mean_var, 2),
    Median = round(median_var, 2),
    SD = round(sd_var, 2),
    IQR = round(iqr_var, 2),
    Min = round(min_var, 2),
    Max = round(max_var, 2)
  ))
}

kable(summary_table)
```

There are very few missing values for most variables. One exception is `ln_wage_growth_hs_grad`, which is missing about 21.8% of observations. Given the higher missingness, we drop this variable and remove counties with any missing data in other variables to maintain a clean dataset.

```{r}
turnout_data <- select(turnout_data, -ln_wage_growth_hs_grad)
turnout_data <- subset(turnout_data, apply(turnout_data, 1, FUN = function(x) {!any(is.na(x))}))
dim(turnout_data)
```

# Exploratory Data Analysis

## Turnout Rate

We observed one invalid turnout rate value greater than 1, which we cap at 1. The resulting histogram suggests turnout rates across counties are roughly normally distributed.

```{r turnout, fig.width=6, fig.height=4}
subset(turnout_data, turnout.rate > 1)[c('State', 'County', 'turnout.rate')]
turnout_data <- turnout_data %>%
  mutate(turnout.rate = case_when(
    turnout.rate > 1 ~ 1,
    .default = turnout.rate
  ))
hist(turnout_data$turnout.rate, 
     main = 'Histogram of Turnout Rate', 
     xlab = 'Turnout Rate', 
     col = "steelblue", 
     border = "white")
```

*Interpretation*: Most counties have turnout rates between about 0.4 and 0.8, with few extreme values.

## Math Scores

There are a few invalid math score values below 0, which we set to 0. The histogram of these scores also appears approximately normal.

```{r math, fig.width=6, fig.height=4}
subset(turnout_data, gsmn_math_g3_2013 < 0)[c('State', 'County', 'gsmn_math_g3_2013')]
turnout_data <- turnout_data %>%
  mutate(gsmn_math_g3_2013 = case_when(
    gsmn_math_g3_2013 < 0 ~ 0,
    .default = gsmn_math_g3_2013
  ))
hist(turnout_data$gsmn_math_g3_2013, 
     main = 'Histogram of 2013 Mean 3rd Grade Math Scores', 
     xlab = 'Mean Score', 
     col = "darkseagreen", 
     border = "white")
```

*Interpretation*: Educational quality indicators, such as math scores, do not vary wildly, suggesting a reasonable distribution that could be associated with differences in county characteristics.

## Relationship Between Poverty and Turnout

The scatter plot below shows the relationship between poverty rate (2010) and turnout rate (2020). There appears to be a strong negative association: counties with higher poverty rates tend to have lower turnout.

```{r poverty, fig.width=6, fig.height=4}
plot(turnout_data$poor_share2010, turnout_data$turnout.rate, 
     main = 'Turnout Rate vs. Poverty Rate', 
     xlab = '2010 Poverty Rate', 
     ylab = '2020 Turnout Rate', 
     pch = 19, col = "tomato")
abline(lm(turnout_data$turnout.rate ~ turnout_data$poor_share2010), col = "darkred", lwd = 2)
```

*Interpretation*: The negative trend between poverty and turnout aligns with sociopolitical theories that higher socioeconomic disadvantage corresponds to lower electoral participation.

# Preliminary Linear Model

Before employing more complex methods, we fit a simple linear regression model to see how well these predictors explain turnout:

```{r model}
lm_model <- lm(turnout.rate ~ . - (State + County + fips), data = turnout_data)
summary(lm_model)
```

*Interpretation*:  
The linear regression model explains approximately 44% of the variance in turnout rates (Adj. R-squared of approximately 0.4386). Education (fraction of college-educated adults), foreign-born share, and black population share are positively associated with higher turnout, while poverty rate, Asian population share, and travel time show negative associations. Some predictors like median household income and math scores are not significantly related to turnout at conventional thresholds. This initial exploration suggests socioeconomic conditions significantly shape local electoral participation.

# Diagnostics

```{r diagnostics, fig.width=6, fig.height=6}
par(mfrow=c(1,2))
plot(lm_model, c(1,2))
par(mfrow=c(1,1))
```

*Interpretation*:

- **Existence of Variance**: Residuals are reasonably dispersed, confirming the existence of variation in the dependent variable.
- **Linearity**: The Residuals vs. Fitted plot does not show pronounced curvature, suggesting linearity is generally satisfied.
- **Independence**: Spatial correlation may exist between neighboring counties; external tests (like Moran’s I) should be considered.
- **Homoscedasticity**: Some fanning in the Residuals vs. Fitted plot suggests heteroscedasticity. Robust standard errors or alternative modeling approaches may be warranted.
- **Normality**: Q-Q plot shows mostly normal residuals, with minor deviations in the tails.

Overall, while the model is a decent fit, improvements—such as using robust errors or accounting for spatial autocorrelation—could refine our inference.

# Introduction of LASSO Regularization

To address potential overfitting and identify the most influential variables, we employ LASSO regularization, which introduces a penalty that can shrink some coefficients to zero.

```{r}
library(glmnet)
library(pheatmap)

predictors <- names(turnout_data)[!(names(turnout_data) %in% c('State', 'County', 'fips', 'turnout.rate'))]
x <- model.matrix(turnout.rate ~ . - (State + County + fips), data = turnout_data)[, -1]
y <- turnout_data$turnout.rate

set.seed(82)
cv.lasso <- cv.glmnet(x, y, alpha = 1, nfolds = 10)
best_lambda <- cv.lasso$lambda.min

lasso_model <- glmnet(x, y, alpha = 1, lambda = best_lambda)
coef(lasso_model)
```

By selecting `lambda.min` through cross-validation, we identify a penalty level that balances predictive accuracy and model complexity. This approach ensures we do not overfit by including too many small-effect predictors.

```{r, fig.width=7, fig.height=5}
cols <- rainbow(ncol(x))
plot(cv.lasso$glmnet.fit, xvar="lambda", label=TRUE, col=cols, lwd=2, cex.lab=1.2, cex.axis=1.2)
abline(v = log(best_lambda), lty=2, col="red", lwd=2)
title("LASSO Coefficients as Function of Regularization Strength", cex.main=1.2)
legend("topright", inset=c(-0.1,0), legend = colnames(x), col = cols, lty=1, lwd=2, cex=0.6, xpd=TRUE)
```

As `log(lambda)` decreases (moving right), regularization strength weakens, and more predictors enter the model with non-zero coefficients. The vertical red line shows the chosen lambda. Predictors that remain at zero near the vertical line are dropped from the final model. This graph visually demonstrates which variables are “important enough” to survive the LASSO penalty.

```{r}
coeffs <- coef(lasso_model)
coeffs_df <- as.data.frame(as.matrix(coeffs))
colnames(coeffs_df) <- "Coefficient"
coeffs_df$Predictor <- rownames(coeffs_df)
coeffs_df <- subset(coeffs_df, Predictor != "(Intercept)")

kept <- coeffs_df$Predictor[coeffs_df$Coefficient != 0]
not_kept <- coeffs_df$Predictor[coeffs_df$Coefficient == 0]

cat("Predictors kept by LASSO:\n")
print(kept)

cat("\nPredictors removed by LASSO (coefficients = 0):\n")
print(not_kept)
```

LASSO retained most predictors but excluded `gsmn_math_g3_2013` and `rent_twobed2015`. This aligns with earlier findings that these variables were not statistically significant in the preliminary linear model.

# Correlation Structure

Examining correlations among predictors helps identify potential multicollinearity and structure in the data.

```{r, fig.width=8, fig.height=8}
cor_matrix <- cor(turnout_data[, predictors], use = "pairwise.complete.obs")
pheatmap(cor_matrix, 
     cluster_rows = TRUE, 
     cluster_cols = TRUE, 
     color = colorRampPalette(c("navy", "white", "firebrick3"))(50),
     main = "Heatmap of Predictor Correlations",
     height = 30)
```

The heatmap shows groups of variables that cluster together, indicating underlying socioeconomic dimensions (e.g., poverty and race-related measures clustered together, economic growth and density measures in another cluster). These clusters may reflect underlying latent factors that shape voter turnout.

# Interaction Terms and Revised Models

We test whether adding an interaction term between education and poverty (`frac_coll_plus2010:poor_share2010`) improves model performance.

```{r}
model_reduced <- lm(turnout.rate ~ . - State - County - fips - gsmn_math_g3_2013 - rent_twobed2015, data = turnout_data)
model_full <- lm(turnout.rate ~ . - State - County - fips - gsmn_math_g3_2013 - rent_twobed2015 
                 + frac_coll_plus2010:poor_share2010, 
                 data = turnout_data)

anova_test <- anova(model_reduced, model_full)
anova_test
```

*Interpretation*:  
A highly significant p-value (2.2e-16) suggests the interaction between college education fraction and poverty share is crucial, indicating that the effect of education on turnout may depend on the poverty context of the county (and vice versa).

# Final Model - Random Effects

```{r}
install.packages("nlme")
```

```{r}
library(nlme)

# Using the `lme()` function from nlme:
# We drop the variables that LASSO zeroed out and treat State as a grouping factor for random intercepts.
random_effects_model_nlme <- lme(
  fixed = turnout.rate ~ . - State - County - fips - gsmn_math_g3_2013 - rent_twobed2015,
  random = ~ 1 | State,
  data = turnout_data,
  method = "REML"
)

summary(random_effects_model_nlme)

```
Compared to the fixed-effects model, which includes an indicator (dummy) variable for every state, the random intercept model offers a more flexible approach. The fixed-effects model assigns each state its own intercept, which can explain a substantial portion of turnout differences across states (as indicated by the high adjusted $R^2$ of about 0.65 in an earlier analysis). However, this comes at the cost of potentially overfitting in states with very few counties, where the estimated state effect may be unstable or imprecise. In contrast, the random intercept model assumes that state effects are drawn from a common distribution, effectively "shrinking" estimates for states with limited data toward the overall mean. Thus, while the fixed-effects model provides a useful baseline by fully controlling for all state-level differences, the random effects approach achieves a balance between capturing state-level heterogeneity and ensuring stable, reliable estimates across all states.

After accounting for the included county-level socioeconomic predictors, there is still significant variation in voter turnout across states. The standard deviation of the state-level random intercept (approximately 0.0616) indicates that some states have systematically higher or lower baseline turnout 
than the overall mean, even after controlling for observed predictors.

The residual standard deviation is about 0.0765, suggesting that much of the county-level variation is explained by the included variables and the state random effect, but not all of it. The fixed intercept of roughly 0.668 indicates that, on average (when all predictors are at their reference levels), 
turnout is around 66.8% across counties, and this estimate is highly statistically significant. The AIC and BIC values provide a means to compare this model’s fit with alternative specifications, potentially guiding further model refinement. Note the AIC/BIC is lower due to the model sacrificing data fit for generalizability. 

Overall, these results highlight the importance of both measured county-level socioeconomic factors and unmeasured state-level contexts in shaping voter turnout. The random intercept model captures the hierarchical structure of the data, acknowledging that counties are nested within states, and that states differ in ways not fully captured by the included predictors.

# Conclusion

Our analysis shows that socioeconomic and demographic factors strongly influence county-level voter turnout. Education and certain demographic features (e.g., black population share) are robust, positive predictors of turnout, while higher poverty rates, longer travel times, and certain population characteristics (e.g., Asian population share) are negatively associated. LASSO regularization supports the exclusion of non-influential predictors, refining the model and reinforcing the significance of key variables.

Incorporating interaction terms and state random effects further refines our understanding, revealing that the influence of education on turnout may be contingent on the economic context and that state-level factors account for substantial variation across the U.S. counties.

These findings have implications for policymakers and organizations interested in increasing voter participation. Interventions that improve socioeconomic conditions, reduce poverty, enhance education, and consider unique state-level political climates could foster higher electoral engagement.

# Appendix

# Model Including State Fixed Effects

We run a model excluding the variables zeroed out by LASSO and adding state fixed effects to control for unobserved state-level heterogeneity:

```{r}
# Model Including State Fixed Effects
model_post_lasso <- lm(
  turnout.rate ~ . - State - County - fips - gsmn_math_g3_2013 - rent_twobed2015 + factor(State),
  data = turnout_data
)

summary(model_post_lasso)

model_post_lasso_aic <- AIC(model_post_lasso)
model_post_lasso_bic <- BIC(model_post_lasso)

cat("AIC:", model_post_lasso_aic, "\nBIC:", model_post_lasso_bic, "\n")
```

*Interpretation*:
With state fixed effects, the adjusted $R^2$ improves (around 0.646), suggesting that differences between states explain a significant portion of turnout variation. After controlling for state-level factors, education, poverty, and various demographic characteristics remain significant. Notably, poverty and time-to-work remain negatively associated with turnout, while educational attainment consistently shows a positive association.

This fixed effects specification suggests that while local socioeconomic conditions are important, broader state-level contexts also shape the electoral participation landscape.

Note, we still prefer random effects given the structure of the data (state-county) as well as to prevent overfitting.


# Potential Limitations

1. **Data Handling Issues**: Dropping variables with missing values (e.g., `ln_wage_growth_hs_grad`) without considering imputation methods leads to potential loss of valuable information.

2. **Confounding Variables**: Given a lack of external data, the analysis does not fully account for other important factors such as political engagement, campaign efforts, voting laws, or spatial autocorrelation, which could influence voter turnout.

3. **Temporal Mismatch**: Using data from different time frames (e.g., turnout from 2020 and predictors from 2010 or 2016) may introduce biases due to temporal changes in socioeconomic conditions.
